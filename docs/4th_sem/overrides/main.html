{% extends "base.html" %}


<!-- Announcement bar -->
{% block announce %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  For updates follow us on 

  <!-- instagram -->

  <a href="https://www.instagram.com/collegehive.in/">
    <span class="twemoji instagram">
      {% include ".icons/fontawesome/brands/instagram.svg" %}
    </span>
    <strong>Instagram</strong>

  </a>
  and



  <!-- linkedlin  dd6215-->

<a href="https://www.linkedin.com/company/college-hives/">
    <span class="twemoji linkedin">
      {% include ".icons/fontawesome/brands/linkedin.svg" %}
    </span>
    <strong>LinkedIn</strong>

</a>

.

Finding any issues with the notes? Report them on our <a href="https://www.instagram.com/collegehive.in/" style="color: #dd6215">
  <span class="twemoji instagram">
    {% include ".icons/fontawesome/brands/instagram.svg" %}
  </span>
  <strong>Instagram</strong>

</a> DM

  
<!-- Check out our Fun time page for some fun stuff ,

<a href="https://collegehive.in/Other/funtime.html">
    <span class="twemoji fun">
        <i class="fa fa-smile-o" aria-hidden="true"></i>
    </span>
    <strong>Fun Time</strong>
</a> -->


<!-- just like dropdown button with list to select from,but make it as drop up button that is for choosing music type and a play pause button -->


<!-- HTML -->

<!-- HTML -->


{% endblock %}


{% block content %}

{{ super() }}

<script type="text/javascript">
  (function(c,l,a,r,i,t,y){
      c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
      t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
      y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
  })(window, document, "clarity", "script", "pc7i8ndcwn");
</script>




{% endblock %}

{% block footer %}



 <!-- Core Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    
    <!-- Markdown & Sanitizer Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@2.4.0/dist/purify.min.js"></script>

    <!-- Syntax Highlighting for Code Blocks -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- ======================================================= -->
    <!-- ============== DEPENDENCIES END ======================= -->
    <!-- ======================================================= -->

    <style>
    /* ======================================================= */
    /* ============== CHATBOT STYLES START =================== */
    /* ======================================================= */

    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

    :root {
        --chat-primary-color: #5A5EB9;
        --chat-primary-light: #7a7fe3;
        --chat-font-color: #333;
        --chat-bubble-user-bg: #E3E5FF;
        --chat-bubble-bot-bg: #FFFFFF;
        --chat-border-radius-md: 16px;
        --chat-border-radius-lg: 20px;
    }

    /* --- The Launcher Button --- */
    #hive-launcher {
        position: fixed; bottom: 20px; right: 20px; background-color: var(--chat-primary-color);
        color: white; border: none; border-radius: 9999px; padding: 12px 20px;
        display: flex; align-items: center; gap: 10px; font-family: 'Inter', sans-serif;
        font-size: 16px; font-weight: 500; cursor: pointer;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        z-index: 1000;
    }
    #hive-launcher:hover { transform: translateY(-3px); box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2); }

    /* --- The Chatbox Container --- */
    #hive-chatbox {
        position: fixed; bottom: 20px; right: 20px; width: 400px;
        max-width: 90vw; height: 70vh; max-height: 650px;
        border-radius: var(--chat-border-radius-lg); box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        background: rgba(245, 245, 247, 0.8); backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px); border: 1px solid rgba(0, 0, 0, 0.05);
        display: flex; flex-direction: column; overflow: hidden; z-index: 1001;
        font-family: 'Inter', sans-serif; opacity: 0;
        transform: scale(0.95) translateY(10px); transform-origin: bottom right;
    }

    /* --- Chatbox Header --- */
    .chat-header {
        padding: 1rem 1.25rem; border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        display: flex; justify-content: space-between; align-items: center;
        flex-shrink: 0; background-color: rgba(255, 255, 255, 0.7);
    }
    .chat-header h3 { margin: 0; font-size: 1.1rem; font-weight: 600; color: var(--chat-font-color); }
    .header-buttons { display: flex; align-items: center; gap: 8px; }
    .header-btn {
        background: none; border: none; cursor: pointer; padding: 4px; border-radius: 50%;
        display: flex; align-items: center; justify-content: center;
        transition: background-color 0.2s; color: #555;
    }
    .header-btn:hover { background-color: rgba(0, 0, 0, 0.1); color: #000; }

    /* --- Chat Logs & Messages --- */
    #chat-logs {
        flex-grow: 1; padding: 1rem; overflow-y: auto;
        display: flex; flex-direction: column; gap: 1rem; min-height: 0;
    }
    #chat-logs::-webkit-scrollbar { width: 6px; }
    #chat-logs::-webkit-scrollbar-track { background: transparent; }
    #chat-logs::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 3px; }

    /* .message {
        display: flex; flex-direction: row; gap: 10px; max-width: 95%;
        position: relative;
    }
    .message .avatar {
        width: 32px; height: 32px; border-radius: 50%; display: flex;
        align-items: center; justify-content: center; flex-shrink: 0;
        margin-top: 5px;
    }

    .bot-message { align-self: flex-start; }
    .bot-message .avatar { background-color: var(--chat-primary-color); color: white; }

    .user-message { align-self: flex-end; flex-direction: row-reverse; }
    .user-message .avatar { background-color: #D1D5DB; } */


      /* --- New, Updated CSS --- */
    .message {
        display: flex;
        flex-direction: column; /* CHANGED: Stack items vertically */
        gap: 8px;              /* UPDATED: Space between avatar and bubble */
        max-width: 90%;        /* UPDATED: Slightly less width for better padding */
        position: relative;
    }
    .message .avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        /* margin-top has been removed */
    }
    
    .bot-message {
        align-self: flex-start;
        align-items: flex-start; /* ADDED: Align avatar/bubble to the left */
    }
    .bot-message .avatar { background-color: var(--chat-primary-color); color: white; }

    
    .user-message {
        align-self: flex-end;
        align-items: flex-end;   /* ADDED: Align avatar/bubble to the right */
        /* flex-direction: row-reverse has been removed */
    }
    .user-message .avatar { background-color: #D1D5DB; } */


    .user-message .message-content {
        background-color: var(--chat-primary-color); color: white;
        text-align: justify;

    }
    
    .bot-message .message-content {
        background-color: var(--chat-bubble-bot-bg); color: var(--chat-font-color);
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    .typing-indicator span {
        height: 8px; width: 8px; background-color: #9E9EA1; border-radius: 50%;
        display: inline-block; animation: bounce 1.4s infinite ease-in-out both;
    }
    .typing-indicator span:nth-of-type(1) { animation-delay: -0.32s; }
    .typing-indicator span:nth-of-type(2) { animation-delay: -0.16s; }
    @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }

    /* ============================================= */
    /* === SCOPED RICH CONTENT STYLING START ========= */
    /* ============================================= */

    .message .message-content {
        padding: 14px 20px; border-radius: var(--chat-border-radius-md);
        line-height: 1.6; font-size: 0.7rem; word-wrap: break-word;
    }

    /* These selectors ensure styles ONLY apply inside message bubbles */
    .message-content > *:first-child { margin-top: 0; }
    .message-content > *:last-child { margin-bottom: 0; }

    /* Scoped rule for paragraphs */
    .message-content p { margin: 0 0 0.75em 0; }
    .message-content p:last-child { margin-bottom: 0; }

    /* Scoped rule for lists */
    .message-content ul, .message-content ol {
        margin: 0.5em 0 1em 0; padding-left: 25px;
    }
    .message-content li { margin-bottom: 0.5em;font-size: 13px;  }

    /* Scoped rule for bold text */
    .message-content strong, .message-content b {
        color: var(--chat-primary-color);
        font-weight: 600;
    }

    /* Scoped rule for horizontal rule */
    .message-content hr {
        border: none; height: 1px;
        background-color: rgba(0, 0, 0, 0.1);
        margin: 1.5em 5px;
    }

    /* Scoped rule for code blocks */
    .message-content pre {
        margin: 1em 0; border-radius: 8px; position: relative;
        white-space: pre-wrap; word-break: break-all;
    }
    .message-content pre code.hljs { padding: 1rem; font-size: 0.9em; border-radius: 8px; }

    .copy-code-btn {
        position: absolute; top: 8px; right: 8px; background-color: rgba(255,255,255,0.1);
        color: white; border: none; padding: 4px 8px; border-radius: 6px;
        cursor: pointer; font-size: 0.8em; opacity: 0.7; transition: all 0.2s;
        display: flex; align-items: center; gap: 4px;
    }
    .copy-code-btn:hover { opacity: 1; background-color: rgba(255,255,255,0.2); }

    /* =========================================== */
    /* === SCOPED RICH CONTENT STYLING END ========= */
    /* =========================================== */

    /* --- Input Area --- */
    .chat-input-area {
        padding: 1rem 1.25rem; border-top: 1px solid rgba(0, 0, 0, 0.08);
        background: rgba(255, 255, 255, 0.5); flex-shrink: 0;
    }
    #suggestion-chips { display: flex; gap: 8px; margin-bottom: 12px; flex-wrap: wrap; }
    .chip {
        background-color: rgba(255,255,255,0.8); border: 1px solid rgba(0,0,0,0.1);
        color: var(--chat-primary-color); padding: 6px 12px; border-radius: 9999px;
        font-size: 0.85em; cursor: pointer; transition: all 0.2s;
    }
    .chip:hover { background-color: white; border-color: var(--chat-primary-color); }

    .input-wrapper {
        display: flex; align-items: flex-end; gap: 10px; background-color: white;
        border-radius: var(--chat-border-radius-md); padding: 8px 12px;
        border: 1px solid rgba(0,0,0,0.1); transition: border-color 0.2s;
    }
    .input-wrapper:focus-within { border-color: var(--chat-primary-color); }

    #chat-input {
        flex-grow: 1; border: none; outline: none; background: none; resize: none;
        font-family: 'Inter', sans-serif; font-size: 1rem; max-height: 100px;
        line-height: 1.5; color: var(--chat-font-color);
    }
    #chat-input::placeholder { color: #999; }

    #chat-send-btn {
        background-color: var(--chat-primary-color); border: none; border-radius: 10px;
        width: 36px; height: 36px; display: flex; align-items: center;
        justify-content: center; cursor: pointer; color: white;
        flex-shrink: 0; transition: background-color 0.2s;
    }
    #chat-send-btn:hover { background-color: var(--chat-primary-light); }
    #chat-send-btn:disabled { background-color: #ccc; cursor: not-allowed; }
    </style>

    

    <!-- Chatbot Component -->
    <button id="hive-launcher"><i data-lucide="message-circle"></i><span class="launcher-text">Ask Hive</span></button>
    <div id="hive-chatbox" style="display: none;">
        <div class="chat-header">
            <h3>Hive Chat</h3>
            <div class="header-buttons">
                <button id="chat-clear-btn" class="header-btn" title="Clear Chat"><i data-lucide="trash-2"></i></button>
                <button id="chat-close-btn" class="header-btn" title="Close Chat"><i data-lucide="x"></i></button>
            </div>
        </div>
        <div id="chat-logs"></div>
        <div class="chat-input-area">
            <div id="suggestion-chips"></div>
            <div class="input-wrapper">
                <textarea id="chat-input" placeholder="Ask anything..." rows="1"></textarea>
                <button id="chat-send-btn"><i data-lucide="arrow-up"></i></button>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- SECTION 1: CONSTANTS AND STATE MANAGEMENT ---
        const geminiHexApiKey = "41497a61537941467a37366d424e315a667a6d3754667068543151634c4d2d4c70706443763745"; // This is a placeholder
        const decodedApiKey = hexDecode(geminiHexApiKey);

        // --- NEW: AI Prompt updated to remove headings ---
        const custom_instruction = `
I am Hive Chat, an AI assistant from CollegeHive. My goal is to provide clear, helpful, and well-structured explanations.

**My Personality:**
- I am friendly, professional, and encouraging.
- I use emojis sparingly to add a touch of personality and to highlight key points. 😊

**Formatting Guide (VERY IMPORTANT):**
You MUST format your responses using simple Markdown for readability.
- **Bold Text:** Use '**' to emphasize key terms or for titles/emphasis. Example: The **Malthusian Trap** is a key concept.
- **Lists:** Use bulleted lists ('* ' or '- ') for points.
- **Separators:** Use '---' to create a horizontal rule that visually separates distinct sections.
- **Paragraphs:** Use a single empty line between paragraphs to create space.

**Content Rules:**
- Keep answers concise but comprehensive. Break down complex topics into smaller, digestible parts using the formatting rules above.
- I will not respond to inappropriate, offensive, or unethical content.
- All output should be under 1500 words.

**Initial Context:**
The user is on a page with the following content. Use this as your primary context for the conversation:
"{{PAGE_CONTENT}}"
`;

        let conversationHistory = [];
        const uiState = { isOpen: false, isLoading: false };
        const initialSuggestions = ["Give a simple example for this", "Explain it in simple terms"];

        // --- SECTION 2: ELEMENT SELECTORS ---
        const launcher = document.getElementById('hive-launcher');
        const chatbox = document.getElementById('hive-chatbox');
        const closeBtn = document.getElementById('chat-close-btn');
        const clearBtn = document.getElementById('chat-clear-btn');
        const chatLogs = document.getElementById('chat-logs');
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('chat-send-btn');
        const suggestionChipsContainer = document.getElementById('suggestion-chips');

        // --- SECTION 3: CORE HELPER FUNCTIONS ---
        function hexDecode(hexString) {
            let decodedString = '';
            for (let i = 0; i < hexString.length; i += 2) {
                decodedString += String.fromCharCode(parseInt(hexString.substring(i, i + 2), 16));
            }
            return decodedString;
        }
        const sanitizeHTML = (str) => {
            const temp = document.createElement('div');
            temp.textContent = str;
            return temp.innerHTML;
        };
        
        // --- SECTION 4: PAGE CONTENT SCRAPING ---
        const article = document.querySelector('article.md-content__inner.md-typeset');


        // Create an array to store the extracted content
        const extractedContent = [];

        // Helper function to extract text content from an element
        function extractTextContent(element) {
          if (element.tagName.toLowerCase() === 'table') {
            // Handle tables separately
            extractedContent.push(`<table>${element.outerHTML}</table>`);
          } else if (element.tagName.toLowerCase() === 'ul' || element.tagName.toLowerCase() === 'ol') {
            // Handle unordered and ordered lists
            const listItems = Array.from(element.querySelectorAll('li')).map(li => li.textContent);
            extractedContent.push(`<${element.tagName.toLowerCase()}>${listItems.join('')}</${element.tagName.toLowerCase()}>`);
          } else {
            extractedContent.push(element.textContent);
          }
        }

        // Traverse the article element and extract content from h2, h3, p, table, ul, ol, and li elements
        const elements = article.querySelectorAll('h2, h3, p, table, ul, ol, li');
        elements.forEach(element => {
          extractTextContent(element);
        });
        const joinedString = extractedContent.join(' ');
        getPageContent = joinedString;







        // --- SECTION 5: UI & DOM MANIPULATION ---
        const toggleChatbox = () => {
            uiState.isOpen = !uiState.isOpen;
            if (uiState.isOpen) {
                launcher.style.display = 'none';
                chatbox.style.display = 'flex';
                gsap.to(chatbox, { scale: 1, opacity: 1, y: 0, duration: 0.4, ease: 'power3.out' });
                chatInput.focus();
            } else {
                gsap.to(chatbox, { scale: 0.95, opacity: 0, y: 10, duration: 0.3, ease: 'power3.in', onComplete: () => {
                    chatbox.style.display = 'none';
                    launcher.style.display = 'flex';
                }});
            }
        };

        const scrollToBottom = () => { chatLogs.scrollTop = chatLogs.scrollHeight; };


        const appendMessage = (type, content) => {
        const messageEl = document.createElement('div');
        messageEl.className = `message ${type}-message`;
        
        const avatarIconName = (type === 'bot') ? 'bot' : 'user-2';
        
        messageEl.innerHTML = `
            <div class="avatar"><i data-lucide="${avatarIconName}"></i></div>
            <div class="message-content">${content}</div>
        `;
        
        chatLogs.appendChild(messageEl);
        lucide.createIcons();
        scrollToBottom();
        return messageEl;
    };


        const showTypingIndicator = () => {
            const typingEl = document.createElement('div');
            typingEl.id = 'typing-indicator';
            typingEl.className = 'message bot-message';
            typingEl.innerHTML = `
                <div class="avatar"><i data-lucide="bot"></i></div>
                <div class="message-content typing-indicator"><span></span><span></span><span></span></div>
            `;
            chatLogs.appendChild(typingEl);
            lucide.createIcons();
            scrollToBottom();
        };

        const hideTypingIndicator = () => {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) indicator.remove();
        };
        
        const renderMessageContent = (element, markdownText) => {
            const rawHtml = marked.parse(markdownText, { gfm: true, breaks: true });
            element.innerHTML = DOMPurify.sanitize(rawHtml);
            
            element.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
                const pre = block.parentElement;
                if (pre.querySelector('.copy-code-btn')) return;
                const copyBtn = document.createElement('button');
                copyBtn.className = 'copy-code-btn';
                copyBtn.innerHTML = `<i data-lucide="copy"></i><span>Copy</span>`;
                pre.appendChild(copyBtn);
            });

            lucide.createIcons();
            scrollToBottom();
        };

        const renderSuggestions = () => {
            suggestionChipsContainer.style.display = 'flex';
            suggestionChipsContainer.innerHTML = '';
            initialSuggestions.forEach(text => {
                const chip = document.createElement('div');
                chip.className = 'chip';
                chip.innerText = text;
                suggestionChipsContainer.appendChild(chip);
            });
        };
        const hideSuggestions = () => { suggestionChipsContainer.style.display = 'none'; };

        // --- SECTION 6: API COMMUNICATION ---
        const sendMessageToGemini = (message) => {
            conversationHistory.push({ "role": "user", "content": message });
            
            const geminiContents = [];
            let systemInstructionText = conversationHistory.find(m => m.role === "system")?.content || "";
            systemInstructionText = systemInstructionText.replace("{{PAGE_CONTENT}}", getPageContent);
            const historyForApi = conversationHistory.filter(m => m.role !== "system");

            historyForApi.forEach((item, index) => {
                const role = item.role === "assistant" ? "model" : "user";
                let textContent = item.content;
                if (index === 0) {
                    textContent = systemInstructionText + "\n\nUser Question: " + textContent;
                }
                geminiContents.push({ "role": role, "parts": [{ "text": textContent }] });
            });

            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${decodedApiKey}`;
            const requestBody = { "contents": geminiContents, "generationConfig": { "temperature": 0.7, "maxOutputTokens": 1500, "topP": 0.5 } };
            
            $.ajax({
                url: apiUrl,
                type: "POST",
                headers: { "Content-Type": "application/json" },
                data: JSON.stringify(requestBody),
                success: function(response) {
                    hideTypingIndicator();
                    const geminiResponse = response.candidates[0]?.content?.parts[0]?.text || "I'm sorry, I couldn't get a response.";
                    conversationHistory.push({ "role": "assistant", "content": geminiResponse });
                    
                    const botMessageEl = appendMessage('bot', '');
                    const botContentEl = botMessageEl.querySelector('.message-content');
                    renderMessageContent(botContentEl, geminiResponse);
                },
                error: function(xhr) {
                    console.error("Gemini API Error:", xhr.responseText);
                    hideTypingIndicator();
                    appendMessage('bot', 'I apologize, but I\'m having trouble connecting right now.');
                },
                complete: function() {
                    uiState.isLoading = false;
                    sendBtn.disabled = false;
                    chatInput.focus();
                }
            });
        };

        // --- SECTION 7: CORE LOGIC & EVENT HANDLERS ---
        const handleSendMessage = () => {
            const messageText = chatInput.value.trim();
            if (!messageText || uiState.isLoading) return;
            
            appendMessage('user', sanitizeHTML(messageText));
            chatInput.value = '';
            chatInput.style.height = 'auto';
            uiState.isLoading = true;
            sendBtn.disabled = true;
            hideSuggestions();
            showTypingIndicator();
            sendMessageToGemini(messageText);
        };

        const resetChat = () => {
            chatLogs.innerHTML = '';
            initializeHistoryAndChat();
        };

        const initializeHistoryAndChat = () => {
            conversationHistory = [ { "role": "system", "content": custom_instruction } ];
            appendMessage('bot', 'Hi! I\'m Hive Chat. How can I help you understand the content on this page? 😊');
            renderSuggestions();
        };

        // --- 8. EVENT LISTENER BINDINGS ---
        launcher.addEventListener('click', toggleChatbox);
        closeBtn.addEventListener('click', toggleChatbox);
        clearBtn.addEventListener('click', resetChat);
        sendBtn.addEventListener('click', handleSendMessage);
        chatInput.addEventListener('keydown', (e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSendMessage(); } });
        chatInput.addEventListener('input', () => { chatInput.style.height = 'auto'; chatInput.style.height = `${chatInput.scrollHeight}px`; });

        document.body.addEventListener('click', (e) => {
            if (e.target.closest('.chip')) {
                chatInput.value = e.target.closest('.chip').innerText;
                handleSendMessage();
            }
            if (e.target.closest('.copy-code-btn')) {
                const copyBtn = e.target.closest('.copy-code-btn');
                const pre = copyBtn.parentElement;
                const code = pre.querySelector('code');
                navigator.clipboard.writeText(code.innerText).then(() => {
                    const originalText = copyBtn.innerHTML;
                    copyBtn.innerHTML = `<i data-lucide="check"></i><span>Copied!</span>`;
                    lucide.createIcons();
                    setTimeout(() => { copyBtn.innerHTML = originalText; lucide.createIcons(); }, 2000);
                });
            }
        });

        // --- 9. INITIALIZATION ---
        lucide.createIcons();
        initializeHistoryAndChat();
    });
    </script>


{{ super() }}
{% endblock %}